<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Ernest iFire Lee’s Journal - Chibifire</title>
  <meta name="description" content="This is Ernest ‘iFire’ Lee’s Journal.">
  <meta name="generator" content="bookdown 0.3.18 and GitBook 2.6.7">

  <meta property="og:title" content="Ernest iFire Lee’s Journal - Chibifire" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Ernest ‘iFire’ Lee’s Journal." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Ernest iFire Lee’s Journal - Chibifire" />
  
  <meta name="twitter:description" content="This is Ernest ‘iFire’ Lee’s Journal." />
  

<meta name="author" content="K. S. Ernest (iFire) Lee">


<meta name="date" content="2017-04-16">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="portfolio.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="portfolio.html"><a href="portfolio.html"><i class="fa fa-check"></i><b>2</b> Portfolio</a></li>
<li class="chapter" data-level="3" data-path="physics-in-super-jet-racing-29-june-2015.html"><a href="physics-in-super-jet-racing-29-june-2015.html"><i class="fa fa-check"></i><b>3</b> Physics in Super Jet Racing - 29 June 2015</a><ul>
<li class="chapter" data-level="3.1" data-path="physics-in-super-jet-racing-29-june-2015.html"><a href="physics-in-super-jet-racing-29-june-2015.html#additional-notes"><i class="fa fa-check"></i><b>3.1</b> Additional Notes</a><ul>
<li class="chapter" data-level="3.1.1" data-path="physics-in-super-jet-racing-29-june-2015.html"><a href="physics-in-super-jet-racing-29-june-2015.html#grid-system"><i class="fa fa-check"></i><b>3.1.1</b> Grid System</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ernest ‘iFire’ Lee’s Journal - Chibifire</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="physics-in-super-jet-racing---29-june-2015" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Physics in Super Jet Racing - 29 June 2015</h1>
<p><em>This is a guest article from ReactorScram.</em></p>
<p>I’m ReactorScram, I’ve been doing Ludum Dare since April 2013. This game is a followup to my LD27 entry, “Jet Racing”. People complained it was too 2D so I made 3D physics for this “Super Jet Racing”.</p>
<p>In my game, you race a hovercar. Originally I wanted to make a game like F-Zero where the car sticks to the track and is able to hang upside-down. I could still do this, but it seemed making a big F-Zero track would be time-consuming and hard to test.</p>
<p>The level is only about half-done, but I imagine it existing inside a stadium, like they race monster trucks in. There’s concrete barriers marking the edges of the track, and right before the start / finish line is a one-kilometer wall, angled at 85 degrees, with a checkpoint at the top. The car has a high thrust-weight ratio, and the player is expected to drive straight up the wall, pass the checkpoint, and fall back down.</p>
<p>As my physics method in my custom engine, I used discrete collision detection and explicit Euler integration. Discrete collision detection means I was too lazy to do continuous collision.</p>
<p>Every frame I check whether the car is inside a triangle, then I push it out. I do this up to 20 times, in case the car is in multiple triangles.</p>
<p>Apparently, you must use an epsilon for this, otherwise the car may keep pushing itself out of a triangle that it’s not really in. That one triangle would eat up all the collision resolve steps and leave nothing for the other triangles. During testing, this manifested as: running into a wall and the car would fall through the ground.</p>
<p>When I push the car out of a triangle, I also zero its velocity along the normal of the triangle to simulate an inelastic collision.</p>
<p>There wasn’t any issues with penetration other than falling through the ground.</p>
<p>Near the beginning, I had implemented the AABB check before the triangle check, so briefly the car was not colliding with inclined planes properly.</p>
<p>I didn’t encounter problems with the car rocketing into the air. Even though I’m using explicit Euler, the simulation is very simple and it doesn’t seem to explode. I’m also doing physics at 120 FPS so tunneling has not been an issue. Once I saw it seem to teleport, but it hasn’t happened since then. I don’t know what it was.</p>
<p>It helps that the track doesn’t have any sharp edges where the car might get caught. There’s also no other moving objects than the car, although I’d like to add enemy cars, ghost cars or multiplayer someday.</p>
<p>My method is notable because it was hand-written in Lua over the course of a few days.</p>
<p>Cowritten by Ernest ‘iFire’ Lee</p>
<div id="additional-notes" class="section level2">
<h2><span class="header-section-number">3.1</span> Additional Notes</h2>
<p>Recently Devlin noticed the car’s turning looks too “tight”, that it does not drift enough. I had already allowed the car to drift in theory.</p>
<p>Every frame, car’s sideways velocity is measured and friction is applied to it. If the velocity is small, it will be set to zero, otherwise it will decrease linearly from the friction. The friction was changed so that the threshold for setting the sideways velocity to zero is higher than the amount by which the velocity linearly decreases.</p>
<p>This should simulate a car’s tires having high static friction but low kinetic friction. (Even though it’s a hovercraft). During a normal turn, the car will grip the road, but if the centrifugal force of the turn becomes too high, the grip will suddenly break and the car will drift. There needs to have some different kinds of curves in the track to test whether this feels right.</p>
<p>For the car to drive up walls, its rotation needs to be changed so the Z vector of the car matches the normal of the wall. As part of the collision detection, a list of normals is created of any walls or floors (the engine doesn’t differentiate them) that the car is touching. The game chooses the normal closest to the car’s previous Z vector and assumes that the car should drive along that surface. Afterwards, the game interpolates the car’s quaternion so that the car will gradually rotate to drive along the wall / floor.</p>
<p>As a result of this, the car pitches back when it drives off of a ramp. If the car jumps off a ramp and turn 90 degrees left or right, the car will be turning within the plane of the ramp, and the camera will show the world tilted slightly sideways as the car drifts through the air.</p>
<p>The car is modelled as a sphere of diameter 5 meters. Maybe this is the right ballpark for a racing hovercar, because Formula One cars are 5 meters long. To make sure that the car wouldn’t tunnel through anything, I went to Wikipedia and measured the speed / body length ratios of Formula One cars and SR-71s.</p>
<p>I don’t remember the exact numbers, but in 1 / 120th of a second, an F1 car only moves roughly 80 cm. An SR-71 moves a number of meters, but SR-71s are also 107 feet long.</p>
<p>In Super Jet Racing, the car peaks around 3 meters per frame, which I think is 1200 scale kilometers per hour. I might need to change the graphics to make it feel faster.</p>
<div id="grid-system" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Grid System</h3>
<p>To accomodate large tracks, I use a 3D grid. When the track is loaded, the game iterates over every triangle, placing it into grid buckets based on its AABB. When the game is running, it uses the same function to place the car into grid buckets. Then for collision detection, it only considers triangles within the car’s grid buckets.</p>
<p>The current track has about 1,400 triangles so it is useless to check triangles that are nowhere near the player.</p>
<p>A benchmark was setup that spawns the car, then idles for 100,000 physics frames.</p>
<p>Grid on: - 18.7 seconds - less than 0.2 milliseconds per physics frame, including the time needed to set up the grid.</p>
<p>Grid off: - 2 minutes and 43 seconds: - 1.63 milliseconds per frame.</p>
<p>Right now the game is not hurting for milliseconds, but on a weaker CPU, or on a bigger track, or with multiple players, the grid will be a necessity.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="portfolio.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
